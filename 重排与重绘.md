# é‡æ’ä¸é‡ç»˜


## ä¸€ã€é‡æ’ï¼ˆReflowï¼‰

### 1.1 æ¦‚å¿µ

å½“DOMçš„å˜åŒ–å½±å“äº†å…ƒç´ çš„å‡ ä½•ä¿¡æ¯ï¼ˆå¦‚ä½ç½®å’Œå°ºå¯¸ï¼‰ï¼Œæµè§ˆå™¨éœ€è¦é‡æ–°è®¡ç®—å…ƒç´ çš„å‡ ä½•å±æ€§ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åš**é‡æ’**ã€‚

### 1.2 è§¦å‘é‡æ’çš„æƒ…å†µ

- é¡µé¢åˆå§‹æ¸²æŸ“
- æ·»åŠ /åˆ é™¤å¯è§çš„DOMå…ƒç´ 
- æ”¹å˜å…ƒç´ ä½ç½®ã€å°ºå¯¸ã€å†…å®¹
- æ”¹å˜æµè§ˆå™¨çª—å£å°ºå¯¸ï¼ˆresizeï¼‰
- æ¿€æ´»CSSä¼ªç±»ï¼ˆä¾‹å¦‚ï¼š`:hover`ï¼‰
- è®¾ç½®`style`å±æ€§çš„å€¼
- æŸ¥è¯¢æŸäº›å±æ€§æˆ–è°ƒç”¨æŸäº›è®¡ç®—æ–¹æ³•ï¼ˆå¦‚`offsetWidth`ã€`getComputedStyle`ç­‰ï¼‰

### 1.3 å¸¸è§å¼•èµ·é‡æ’çš„å±æ€§å’Œæ–¹æ³•

**ç›’æ¨¡å‹ç›¸å…³å±æ€§**ï¼š

- `width`ã€`height`ã€`padding`ã€`margin`ã€`border`
- `display`ã€`border-width`ã€`min-height`

**å®šä½å’Œæµ®åŠ¨ç›¸å…³**ï¼š

- `top`ã€`bottom`ã€`left`ã€`right`
- `position`ã€`float`ã€`clear`

**èŠ‚ç‚¹å†…å®¹æˆ–ç»“æ„ç›¸å…³**ï¼š

- `text-align`ã€`overflow`ã€`font-weight`ã€`font-family`
- `line-height`ã€`vertical-align`ã€`white-space`
- `font-size`

**è·å–å¸ƒå±€ä¿¡æ¯çš„æ–¹æ³•**ï¼š

- `offsetWidth`ã€`offsetHeight`ã€`offsetTop`ã€`offsetLeft`
- `clientWidth`ã€`clientHeight`ã€`clientTop`ã€`clientLeft`
- `scrollWidth`ã€`scrollHeight`ã€`scrollTop`ã€`scrollLeft`
- `getComputedStyle()`ã€`getBoundingClientRect()`
- `scrollIntoView()`ã€`scrollTo()`

### 1.4 é‡æ’å½±å“çš„èŒƒå›´

- **å…¨å±€èŒƒå›´**ï¼šä»æ ¹èŠ‚ç‚¹`html`å¼€å§‹å¯¹æ•´ä¸ªæ¸²æŸ“æ ‘è¿›è¡Œé‡æ–°å¸ƒå±€
- **å±€éƒ¨èŒƒå›´**ï¼šå¯¹æ¸²æŸ“æ ‘çš„æŸéƒ¨åˆ†æˆ–æŸä¸€ä¸ªæ¸²æŸ“å¯¹è±¡è¿›è¡Œé‡æ–°å¸ƒå±€

> ğŸ’¡ **æç¤º**ï¼šé‡æ’æ˜¯ä¸å¯é¿å…çš„ï¼Œåªèƒ½å°†é‡æ’å¯¹æ€§èƒ½çš„å½±å“å‡åˆ°æœ€å°ã€‚

## äºŒã€é‡ç»˜ï¼ˆRepaintï¼‰

### 2.1 æ¦‚å¿µ

å½“ä¸€ä¸ªå…ƒç´ çš„å¤–è§‚å‘ç”Ÿæ”¹å˜ï¼Œä½†æ²¡æœ‰æ”¹å˜å¸ƒå±€ï¼Œé‡æ–°æŠŠå…ƒç´ å¤–è§‚ç»˜åˆ¶å‡ºæ¥çš„è¿‡ç¨‹ï¼Œå«åš**é‡ç»˜**ã€‚

### 2.2 å¸¸è§çš„å¼•èµ·é‡ç»˜çš„å±æ€§

**é¢œè‰²ç›¸å…³**ï¼š

- `color`ã€`background`ã€`background-color`ã€`background-image`

**è¾¹æ¡†æ ·å¼ç›¸å…³**ï¼š

- `border-style`ã€`border-radius`ã€`outline`ã€`outline-color`ã€`outline-style`ã€`outline-width`

**è§†è§‰æ•ˆæœç›¸å…³**ï¼š

- `visibility`ã€`box-shadow`ã€`text-decoration`

> ğŸ’¡ **æ³¨æ„**ï¼šé‡æ’å¿…ç„¶ä¼šè§¦å‘é‡ç»˜ï¼Œä½†é‡ç»˜ä¸ä¸€å®šä¼šå¼•å‘é‡æ’ã€‚

## ä¸‰ã€æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 3.1 å‡å°‘é‡æ’èŒƒå›´

#### 1. ä¼˜åŒ–HTMLç»“æ„

å°½é‡ä»¥å±€éƒ¨å¸ƒå±€çš„å½¢å¼ç»„ç»‡HTMLç»“æ„ï¼Œå°½å¯èƒ½å°çš„å½±å“é‡æ’çš„èŒƒå›´ã€‚

#### 2. é¿å…ä½¿ç”¨tableå¸ƒå±€

ä¸è¦ä½¿ç”¨`table`å¸ƒå±€ï¼Œå¯èƒ½å¾ˆå°çš„ä¸€ä¸ªæ”¹åŠ¨ä¼šé€ æˆæ•´ä¸ª`table`çš„é‡æ–°å¸ƒå±€ã€‚

ä¸å¾—å·²ä½¿ç”¨`table`æ—¶ï¼Œå¯ä»¥è®¾ç½®ï¼š

```css
table-layout: auto;
/* æˆ–è€… */
table-layout: fixed;
```

è¿™æ ·å¯ä»¥è®©`table`ä¸€è¡Œä¸€è¡Œåœ°æ¸²æŸ“ï¼Œé™åˆ¶é‡æ’çš„å½±å“èŒƒå›´ã€‚

### 3.2 å‡å°‘é‡æ’æ¬¡æ•°

#### 1. æ ·å¼é›†ä¸­æ”¹å˜

ä¸è¦é¢‘ç¹çš„æ“ä½œæ ·å¼ï¼Œå¯¹äºé™æ€é¡µé¢ï¼Œå¯ä»¥ä¿®æ”¹ç±»åè€Œä¸æ˜¯æ ·å¼ã€‚

```javascript
// âŒ ä¸å¥½çš„å†™æ³•
const el = document.getElementById('test');
el.style.padding = '5px';
el.style.borderLeft = '1px';
el.style.borderRight = '2px';

// âœ… æ¨èå†™æ³•1ï¼šä½¿ç”¨cssText
el.style.cssText = 'padding:5px; border-left:1px; border-right:2px;';

// âœ… æ¨èå†™æ³•2ï¼šä¿®æ”¹class
el.className = 'active';
```

#### 2. åˆ†ç¦»è¯»å†™æ“ä½œ

DOMçš„å¤šä¸ªè¯»æ“ä½œï¼ˆæˆ–å¤šä¸ªå†™æ“ä½œï¼‰ï¼Œåº”è¯¥æ”¾åœ¨ä¸€èµ·ã€‚ä¸è¦ä¸¤ä¸ªè¯»æ“ä½œä¹‹é—´ï¼ŒåŠ å…¥ä¸€ä¸ªå†™æ“ä½œã€‚

```javascript
// âŒ ä¸å¥½çš„å†™æ³•ï¼šè¯»å†™äº¤æ›¿ï¼Œè§¦å‘å¤šæ¬¡é‡æ’
div.style.left = div.offsetLeft + 1 + 'px';
div.style.top = div.offsetTop + 1 + 'px';

// âœ… æ¨èå†™æ³•ï¼šç¼“å­˜å¸ƒå±€ä¿¡æ¯
const curLeft = div.offsetLeft;
const curTop = div.offsetTop;
div.style.left = curLeft + 1 + 'px';
div.style.top = curTop + 1 + 'px';
```

#### 3. å°†DOMç¦»çº¿

ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•å‡å°‘é‡æ’æ¬¡æ•°ï¼š

**æ–¹æ³•ä¸€ï¼šä½¿ç”¨`display:none`**

```javascript
const ul = document.getElementById('mylist');
ul.style.display = 'none';  // éšè—å…ƒç´ ï¼ˆ1æ¬¡é‡æ’ï¼‰
// ... è¿›è¡Œå¤§é‡DOMæ“ä½œ
ul.style.display = 'block'; // æ˜¾ç¤ºå…ƒç´ ï¼ˆ1æ¬¡é‡æ’ï¼‰
```

**æ–¹æ³•äºŒï¼šä½¿ç”¨`DocumentFragment`**

```javascript
const fragment = document.createDocumentFragment();
for (let i = 0; i < 10; i++) {
  const li = document.createElement('li');
  li.innerHTML = 'List item ' + i;
  fragment.appendChild(li);  // ä¸è§¦å‘é‡æ’
}
ul.appendChild(fragment);     // åªè§¦å‘1æ¬¡é‡æ’
```

**æ–¹æ³•ä¸‰ï¼šå…‹éš†èŠ‚ç‚¹**

```javascript
const old = document.getElementById('mylist');
const clone = old.cloneNode(true);
// ... å¯¹cloneè¿›è¡Œæ“ä½œ
old.parentNode.replaceChild(clone, old);
```

#### 4. ä½¿ç”¨absoluteæˆ–fixedè„±ç¦»æ–‡æ¡£æµ

å¯¹äºå¤æ‚åŠ¨ç”»æ•ˆæœï¼Œä½¿ç”¨`position: absolute`æˆ–`position: fixed`ä½¿å…ƒç´ è„±ç¦»æ–‡æ¡£æµï¼Œå‡å°‘å¯¹å…¶ä»–å…ƒç´ çš„å½±å“ã€‚

```css
.animation-element {
  position: absolute; /* æˆ– fixed */
  /* è¿™æ ·ä¿®æ”¹è¯¥å…ƒç´ ä¸ä¼šå½±å“å…¶ä»–å…ƒç´ çš„å¸ƒå±€ */
}
```

#### 5. ä¼˜åŒ–åŠ¨ç”»

- ä½¿ç”¨`transform`å’Œ`opacity`å®ç°åŠ¨ç”»æ•ˆæœï¼ˆè¿™äº›å±æ€§ä¸ä¼šè§¦å‘é‡æ’ï¼‰
- å¯ç”¨GPUåŠ é€Ÿï¼š`will-change`ã€`transform: translateZ(0)`

```css
/* âœ… æ¨èï¼šä½¿ç”¨transformï¼Œä¸è§¦å‘é‡æ’ */
.box {
  transform: translateX(10px);
}

/* âŒ ä¸æ¨èï¼šä½¿ç”¨leftï¼Œè§¦å‘é‡æ’ */
.box {
  left: 10px;
}
```

#### 6. ä½¿ç”¨è™šæ‹ŸDOM

ç°ä»£æ¡†æ¶ï¼ˆReactã€Vueï¼‰ä½¿ç”¨è™šæ‹ŸDOMï¼Œé€šè¿‡diffç®—æ³•å‡å°‘çœŸå®DOMæ“ä½œï¼Œä»è€Œå‡å°‘é‡æ’é‡ç»˜ã€‚

- [æŒæ¡æµè§ˆå™¨é‡ç»˜(repaint)é‡æ’(reflow) - å‰ç«¯è¿›é˜¶](https://juejin.cn/post/6844904083212468238)
- [CSS Triggers](https://csstriggers.com/) - æŸ¥è¯¢CSSå±æ€§è§¦å‘çš„æ¸²æŸ“è¡Œä¸º
- [CSSç¡¬ä»¶åŠ é€Ÿçš„å¥½ä¸å](https://www.jianshu.com/p/99c1e8e0a2a7)